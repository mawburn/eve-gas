<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="msapplication-TileColor" content="#424242" />
    <meta name="theme-color" content="#424242" />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Eve Gas</title>
    <link rel="stylesheet" type="text/css" href="./style.css" />
  </head>
  <body>
    <div id="container">
      <h1>EVE Gas Profits</h1>
      <h2>Based on evepraisal.com</h2>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Mats</th>
            <th></th>
            <th>Output</th>
            <th></th>
            <th class="right">Profit</th>
          </tr>
        </thead>
        <tbody>
          <tr class="reaction">
            <td class="name">C3-FTM Acid</td>
            <td class="mats">
              <pre>
79 x Megacyte
98 x Fullerite-C84
98 x Fullerite-C540
5 x Helium Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output">
              <pre>100 x C3-FTM Acid</pre>
            </td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
          <tr class="reaction">
            <td class="name">Carbon-86 Epoxy Resin</td>
            <td class="mats">
              <pre>
30 x Zydrine
98 x Fullerite-C32
98 x Fullerite-C320
5 x Nitrogen Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output"><pre>160 x Carbon-86 Epoxy Resin</pre></td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
          <tr class="reaction">
            <td class="name">Fullerene Intercalated Graphite</td>
            <td class="mats">
              <pre>
587 x Mexallon
98 x Fullerite-C60
98 x Fullerite-C70
5 x Hydrogen Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output">
              <pre>120 x Fullerene Intercalated Graphite</pre>
            </td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
          <tr class="reaction">
            <td class="name">Fulleroferrocene</td>
            <td class="mats">
              <pre>
978 x Tritanium
196 x Fullerite-C50
98 x Fullerite-C60
5 x Oxygen Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output"><pre>1,000 x Fulleroferrocene</pre></td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
          <tr class="reaction">
            <td class="name">Graphene Nanoribbons</td>
            <td class="mats">
              <pre>
392 x Nocxium
98 x Fullerite-C28
98 x Fullerite-C32
5 x Nitrogen Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output"><pre>120 x Graphene Nanoribbons</pre></td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
          <tr class="reaction">
            <td class="name">Lanthanum Metallofullerene</td>
            <td class="mats">
              <pre>
196 x Nocxium
98 x Fullerite-C70
98 x Fullerite-C84
5 x Oxygen Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output"><pre>120 x Lanthanum Metallofullerene</pre></td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
          <tr class="reaction">
            <td class="name">Methanofullerene</td>
            <td class="mats">
              <pre>
294 x Isogen
98 x Fullerite-C70
98 x Fullerite-C72
5 x Hydrogen Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output"><pre>160 x Methanofullerene</pre></td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
          <tr class="reaction">
            <td class="name">PPD Fullerene Fibers</td>
            <td class="mats">
              <pre>
783 x Pyerite
294 x Fullerite-C50
98 x Fullerite-C60
5 x Hydrogen Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output"><pre>250 x PPD Fullerene Fibers</pre></td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
          <tr class="reaction">
            <td class="name">Scandium Metallofullerene</td>
            <td class="mats">
              <pre>
25 x Zydrine
98 x Fullerite-C72
98 x Fullerite-C28
5 x Helium Fuel Block
              </pre>
            </td>
            <td class="mats-price"></td>
            <td class="output"><pre>160 x Scandium Metallofullerene</pre></td>
            <td class="output-price"></td>
            <td class="profit"></td>
          </tr>
        </tbody>
      </table>
      <div id="gasListings">
        <h2>Buy Order Prices</h2>
        <div class="mb2">
          Markdown:
          <input
            id="markdown"
            value=".90"
            type="number"
            min=".10"
            max="1.0"
            step=".05"
          />
          <button id="searchBuys">search</button>
        </div>
        <div class="gas-row">
          <div id="fullerite-c28">Fullerite-C28</div>
          <div id="fullerite-c28base"></div>
          <div id="fullerite-c28val"></div>
        </div>
        <div class="gas-row">
          <div id="fullerite-c32">Fullerite-C32</div>
          <div id="fullerite-c32base"></div>
          <div id="fullerite-c32val"></div>
        </div>
        <div class="gas-row">
          <div id="fullerite-c320">Fullerite-C320</div>
          <div id="fullerite-c320base"></div>
          <div id="fullerite-c320val"></div>
        </div>
        <div class="gas-row">
          <div id="fullerite-c50">Fullerite-C50</div>
          <div id="fullerite-c50base"></div>
          <div id="fullerite-c50val"></div>
        </div>
        <div class="gas-row">
          <div id="fullerite-c540">Fullerite-C540</div>
          <div id="fullerite-c540base"></div>
          <div id="fullerite-c540val"></div>
        </div>
        <div class="gas-row">
          <div id="fullerite-c60">Fullerite-C60</div>
          <div id="fullerite-c60base"></div>
          <div id="fullerite-c60val"></div>
        </div>
        <div class="gas-row">
          <div id="fullerite-c70">Fullerite-C70</div>
          <div id="fullerite-c70base"></div>
          <div id="fullerite-c70val"></div>
        </div>
        <div class="gas-row">
          <div id="fullerite-c72">Fullerite-C72</div>
          <div id="fullerite-c72base"></div>
          <div id="fullerite-c72val"></div>
        </div>
        <div class="gas-row">
          <div id="fullerite-c84">Fullerite-C84</div>
          <div id="fullerite-c84base"></div>
          <div id="fullerite-c84val"></div>
        </div>
      </div>
    </div>
    <script>
      ;((w, d) => {
        const getPrices = data =>
          fetch('https://dcggsza900.execute-api.us-east-1.amazonaws.com/do', {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: data,
          }).then(res => {
            if (res.ok) {
              return res.json()
            }

            console.error(res.statusText)
          })

        const rows = d.querySelectorAll('.reaction')

        rows.forEach(async r => {
          const mats = await getPrices(r.querySelector('.mats > pre').innerHTML)
          const outputs = await getPrices(
            r.querySelector('.output > pre').innerHTML
          )

          const out = r.querySelector('.profit')

          const matVal = mats.appraisal.totals.sell.toFixed(0)
          const reactionVal = outputs.appraisal.totals.buy.toFixed(0)

          const value = `${(reactionVal - matVal).toFixed(0)}`.replace(
            /\B(?=(\d{3})+(?!\d))/g,
            ','
          )

          out.innerHTML = `<div>M: ${matVal
            .toString()
            .replace(
              /\B(?=(\d{3})+(?!\d))/g,
              ','
            )}</div><div>R: ${reactionVal
            .toString()
            .replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</div><div>P: ${value}</div>`
        })
      })(window, document)

      async function searchBuys(e) {
        e.preventDefault()

        const rate = document.getElementById('markdown').value

        const gasPrices = await fetch(
          'https://dcggsza900.execute-api.us-east-1.amazonaws.com/do',
          {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: `
            Fullerite-C28 1
            Fullerite-C32 1
            Fullerite-C320 1
            Fullerite-C50 1
            Fullerite-C540 1
            Fullerite-C60 1
            Fullerite-C70 1
            Fullerite-C72 1
            Fullerite-C84 1
          `,
          }
        ).then(res => {
          if (res.ok) {
            return res.json()
          }

          console.error(res.statusText)
        })

        gasPrices.appraisal.items.forEach(item => {
          const name = item.name.toLowerCase()

          if (item && item.prices && item.prices.buy) {
            const val = (item.prices.buy.max * rate).toFixed(0)

            document.getElementById(
              `${name}base`
            ).innerHTML = `${item.prices.buy.max}`
            document.getElementById(`${name}val`).innerHTML = `${val}`
          } else {
            console.error('Error with item', item)
          }
        })
      }

      document
        .getElementById('searchBuys')
        .addEventListener('click', searchBuys)
    </script>
  </body>
</html>
